@using TRKPortfolio.Web.ViewModels.Posts.InputModel
@model PostCommentInputModel

<div class="row d-flex pt-5">

    <div class="col-6 offset-3 mt-5 align-self-center">

        <h3 class="mb-5">@Model.Post.Title</h3>

        @if (User.IsInRole("Admin"))
        {
            <a class="btn col-6 offset-3 mb-4"
               asp-area="Administration"
               asp-controller="Posts"
               asp-action="Edit"
               asp-route-id="@Model.Post.Id">
                Edit Post
            </a>

            <a id="danger" class="btn col-6 offset-3 mt-3 mb-4"
               asp-area="Administration"
               asp-controller="Posts"
               asp-action="Delete"
               asp-route-id="@Model.Post.Id">
                Delete Post
            </a>
        }

        <p>@Model.Post.Description</p>

    </div>

    <img class="col-6 offset-3" src="/Images/@Model.Post.Thumbnail" alt="Alternate Text" />

    @foreach (var paragraph in Model.Post.Paragraphs)
    {
        <div class="col-6 offset-3 mt-5 align-self-center">

            <h2 class="mb-4">@paragraph.ParagraphTitle</h2>
            <p>@paragraph.ParagraphContent</p>

            @if (paragraph.ParagraphPath != null)
            {
                <img class="col-12 p-0" src="/Images/@paragraph.ParagraphPath" alt="Alternate Text" />
            }

        </div>
    }

    @if (User.Identity.IsAuthenticated)
    {
        <form class="col-6 offset-3 mt-5"
              enctype="multipart/form-data"
              asp-controller="Comments"
              asp-action="Create"
              method="post">

            <div class="form-group">
                <label>Comment</label>
                <textarea cols="40" rows="5" id="customeInput"
                          asp-for="@Model.Comment.Text"
                          class="form-control h-50"
                          placeholder="Write your comment"></textarea>
                <input type="hidden"
                       asp-for="@Model.Comment.PostId"
                       value="@Model.Post.Id">
                <span asp-validation-for="@Model.Comment"
                      class="text-danger">
                </span>

            </div>

            <a onclick="this.closest('form').submit();return false;">
                <img class="btn col-1 offset-11" src="/Images/iconfinder-icon.svg" alt="Alternate Text" />
            </a>

        </form>
    }
    else
    {
        <h2 class="text-center col-6 offset-3 mt-5">If you want to write a comment Login into your account</h2>

        <div class="row col-8 offset-3 mb-5">

            <a id="secondary" class="btn col-8 mt-5"
               asp-area="Identity"
               asp-controller="Account"
               asp-action="Login">
                I already have an account
            </a>

            <a class="btn col-8 mt-2"
               asp-area="Identity"
               asp-controller="Account"
               asp-action="Register">
                I don't have an account
            </a>
        </div>
    }

    <h3 class="col-6 offset-3 mb-4">Comments:</h3>

    @foreach (var comment in Model.Comments.Reverse())
    {
        <div class="col-6 offset-3 mt-4 align-self-center">
            <p><b>@comment.Text</b></p>

            <div class="row">

                <p class="col-8 align-self-center">@comment.CreatedOn.ToString("dd MMMM yyyy HH:mm")</p>

                @if (User.IsInRole("Admin"))
                {
                    <div class="col-2 offset-2">

                        <a asp-controller="Comments"
                           asp-action="Delete"
                           asp-route-id="@comment.Id">
                            <img id="danger" class="btn col-8" src="/Images/delete.svg" alt="Alternate Text" />
                        </a>
                    </div>
                }
            </div>
            <hr />
        </div>

        foreach (var reply in comment.Replies)
        {
            <div class="col-6 offset-3 pl-5 align-self-center">

                <p>
                    <b>@reply.Text</b>
                </p>

                <div class="row">

                    <p class="col-8 align-self-center">@reply.CreatedOn.ToString("dd MMMM yyyy HH:mm")</p>

                    @if (User.IsInRole("Admin"))
                    {
                        <div class="col-2 offset-2">

                            <a asp-controller="Comments"
                               asp-action="DeleteReply"
                               asp-route-id="@reply.Id">
                                <img id="danger" class="btn col-8" src="/Images/delete.svg" alt="Alternate Text" />
                            </a>

                        </div>
                    }
                </div>
                <hr />
            </div>
        }

        @if (User.Identity.IsAuthenticated)
        {
            <form class="col-6 offset-3 pl-5"
                  enctype="multipart/form-data"
                  asp-controller="Comments"
                  asp-action="Reply"
                  method="post">

                <div class="form-group">

                    <textarea cols="40" rows="2" id="customeInput"
                              asp-for="@Model.Comment.Text"
                              class="form-control h-25" placeholder="Reply"></textarea>
                    <input type="hidden"
                           asp-for="@Model.Comment.CommentId"
                           value="@comment.Id">
                    <input type="hidden"
                           asp-for="@Model.Comment.PostId"
                           value="@Model.Post.Id">
                    <span asp-validation-for="@Model.Comment"
                          class="text-danger"></span>
                </div>
                <a onclick="this.closest('form').submit();return false;">
                    <img class="btn col-1 offset-11" src="/Images/iconfinder-icon.svg" alt="Alternate Text" />
                </a>

            </form>
        }
    }
</div>